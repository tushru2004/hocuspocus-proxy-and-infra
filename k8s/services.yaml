# PostgreSQL Service (ClusterIP - internal only)
apiVersion: v1
kind: Service
metadata:
  name: postgres-service
  namespace: hocuspocus
  labels:
    app: postgres
spec:
  type: ClusterIP
  selector:
    app: postgres
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP

---
# Mitmproxy Service (ClusterIP - internal only)
# Traffic is redirected via iptables, not through the service
apiVersion: v1
kind: Service
metadata:
  name: mitmproxy-service
  namespace: hocuspocus
  labels:
    app: mitmproxy
spec:
  type: ClusterIP
  selector:
    app: mitmproxy
  ports:
    - name: proxy
      port: 8080
      targetPort: 8080
      protocol: TCP

---
# VPN Service (LoadBalancer with UDP support)
# This exposes IKEv2 ports to the internet
apiVersion: v1
kind: Service
metadata:
  name: vpn-service
  namespace: hocuspocus
  labels:
    app: vpn-server
  annotations:
    # GKE Load Balancer annotations
    cloud.google.com/network-tier: "Standard"  # Cheaper than Premium
spec:
  type: LoadBalancer
  loadBalancerIP: "35.210.225.36"  # Static IP from terraform
  externalTrafficPolicy: Local  # Preserve client IP
  selector:
    app: vpn-server
  ports:
    - name: ike
      port: 500
      targetPort: 500
      protocol: UDP
    - name: nat-t
      port: 4500
      targetPort: 4500
      protocol: UDP
